<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anesthesia Dose Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* 1. ป้องกันการคลุมดำเลือกข้อความ (Text Selection) */
        body { 
            font-family: 'Sarabun', sans-serif; 
            -webkit-user-select: none; /* Safari */
            -ms-user-select: none; /* IE 10 and IE 11 */
            user-select: none; /* Standard syntax */
        }
        /* แต่ต้องยอมให้คลุมดำและพิมพ์ในช่องกรอกตัวเลขได้ */
        input {
            -webkit-user-select: auto;
            -ms-user-select: auto;
            user-select: auto;
        }

        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
            -webkit-appearance: none; margin: 0; 
        }
        input[type=number] { -moz-appearance: textfield; }
    </style>
</head>
<body class="bg-gray-100 p-4 md:p-8 transition-colors duration-500" id="body-bg" oncontextmenu="return false;">

    <div class="max-w-xl mx-auto bg-white p-6 rounded-lg shadow-md border-t-4" id="card-border" style="border-color: #93c5fd;">
        <h1 id="app-title" class="text-2xl font-bold text-center mb-6 text-blue-400 transition-colors duration-300">
            Drug Dose Calculator
        </h1>

        <div class="space-y-6 mb-6">
            <div class="flex flex-col items-center">
                <label class="block text-gray-700 font-semibold mb-3">Gender</label>
                <div class="flex items-center justify-center space-x-4">
                    <span id="label-male" class="text-blue-400 font-bold transition-colors duration-300">Male</span>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="gender-toggle" class="sr-only peer" onchange="calculate()">
                        <div class="w-14 h-7 bg-blue-300 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-pink-300"></div>
                    </label>
                    <span id="label-female" class="text-gray-400 font-bold transition-colors duration-300">Female</span>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-gray-700 font-semibold mb-2 pl-1">Height (cm)</label>
                    <input type="number" id="height" oninput="calculate()" placeholder="160" class="w-full px-4 py-2 text-center text-lg border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-300 transition-colors shadow-sm">
                </div>
                <div>
                    <label class="block text-gray-700 font-semibold mb-2 pl-1">Actual Weight (kg)</label>
                    <input type="number" id="weight" oninput="calculate()" placeholder="60" class="w-full px-4 py-2 text-center text-lg border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-300 transition-colors shadow-sm">
                </div>
            </div>

            <div id="bmi-display" class="hidden flex justify-center items-center">
                <span class="text-gray-600 font-semibold mr-2">BMI</span>
                <span id="res-bmi" class="text-xl font-bold res-text"></span>
                <span id="bmi-label" class="ml-2 text-sm font-medium text-gray-800">kg/m<sup>2</sup></span>
            </div>
        </div>

        <div id="waiting-message" class="text-center text-gray-400 italic py-4">
            Please enter height and weight to display calculations.
        </div>

        <div id="results-section" class="hidden">
            <h2 class="text-xl font-bold text-gray-700 mb-3 border-b pb-2">Weight Parameters</h2>
            <div id="weight-card" class="grid grid-cols-2 gap-6 mb-6 p-6 rounded-3xl shadow-inner bg-blue-50 transition-colors duration-300">
                <div><span class="text-sm text-gray-600">Actual (TBW)</span> <br><span id="res-tbw" class="text-2xl font-bold text-blue-500 res-text"></span> kg</div>
                <div><span class="text-sm text-gray-600">Ideal (IBW)</span> <br><span id="res-ibw" class="text-2xl font-bold text-blue-500 res-text"></span> kg</div>
                
                <div id="container-lbw"><span class="text-sm text-gray-600">Lean (LBW)</span> <br><span id="res-lbw" class="text-2xl font-bold text-blue-500 res-text"></span> kg</div>
                <div id="container-adjbw"><span class="text-sm text-gray-600">Adjusted (AdjBW)</span> <br><span id="res-adjbw" class="text-2xl font-bold text-blue-500 res-text"></span> kg</div>
            </div>

            <h2 class="text-xl font-bold text-gray-700 mb-3 border-b pb-2">Suggested Doses</h2>
            <div class="overflow-x-auto rounded-lg border border-gray-200 shadow-sm">
                <table class="w-full text-left border-collapse">
                    <thead>
                        <tr class="bg-gray-50">
                            <th class="p-3 border-b font-semibold text-gray-600">Drug</th>
                            <th class="p-3 border-b font-semibold text-gray-600">Dose Basis</th>
                            <th class="p-3 border-b font-semibold text-gray-600 text-right">Calculated Dose</th>
                        </tr>
                    </thead>
                    <tbody id="drug-table-body" class="bg-white">
                        </tbody>
                </table>
            </div>
            <p class="text-xs text-red-400 mt-4 text-center">* Disclaimer: This information is for reference only. Please verify calculations and doses before clinical use.</p>
        </div>
    </div>

    <script>
        document.onkeydown = function(e) {
            if (e.key === "F12") return false;
            if (e.ctrlKey && e.shiftKey && (e.key === "I" || e.key === "i")) return false; 
            if (e.ctrlKey && e.shiftKey && (e.key === "J" || e.key === "j")) return false; 
            if (e.ctrlKey && e.shiftKey && (e.key === "C" || e.key === "c")) return false; 
            if (e.ctrlKey && (e.key === "U" || e.key === "u")) return false; 
        };

        function calculate() {
            const isFemale = document.getElementById('gender-toggle').checked;
            const gender = isFemale ? 'female' : 'male';
            
            updateTheme(isFemale);

            const heightInput = parseFloat(document.getElementById('height').value);
            const weightInput = parseFloat(document.getElementById('weight').value);

            if (isNaN(heightInput) || isNaN(weightInput) || heightInput <= 0 || weightInput <= 0) {
                document.getElementById('results-section').classList.add('hidden');
                document.getElementById('bmi-display').classList.add('hidden');
                document.getElementById('waiting-message').classList.remove('hidden');
                return;
            }

            // คำนวณ BMI
            const heightInMeters = heightInput / 100;
            const bmi = weightInput / (heightInMeters * heightInMeters);

            // แสดง BMI ออกทางหน้าจอ
            document.getElementById('bmi-display').classList.remove('hidden');
            const resBmiEl = document.getElementById('res-bmi');
            
            resBmiEl.innerText = bmi.toFixed(1);

            const isObese = bmi >= 30;

            // ควบคุมการแสดงผล Weight Parameters ตาม BMI
            if (isObese) {
                document.getElementById('container-lbw').classList.remove('hidden');
                document.getElementById('container-adjbw').classList.remove('hidden');
            } else {
                document.getElementById('container-lbw').classList.add('hidden');
                document.getElementById('container-adjbw').classList.add('hidden');
            }

            document.getElementById('results-section').classList.remove('hidden');
            document.getElementById('waiting-message').classList.add('hidden');

            let ibw = gender === 'male' ? 50 + 0.91 * (heightInput - 152.4) : 45.5 + 0.91 * (heightInput - 152.4);
            if (weightInput < ibw) ibw = weightInput; 
            
            const adjbw = ibw + 0.4 * (weightInput - ibw);
            const lbw = ibw * 1.2;

            document.getElementById('res-tbw').innerText = weightInput.toFixed(1);
            document.getElementById('res-ibw').innerText = ibw.toFixed(1);
            document.getElementById('res-adjbw').innerText = adjbw.toFixed(1);
            document.getElementById('res-lbw').innerText = lbw.toFixed(1);

            const drugs = [
                { name: "Propofol", note: "(Induction)", minMultiplier: 1.0, maxMultiplier: 2.5, unit: "mg", baseName: "LBW", baseValue: lbw },
                { name: "Thiopental", note: "(Induction)", minMultiplier: 3.0, maxMultiplier: 4.0, unit: "mg", baseName: "LBW", baseValue: lbw },
                { name: "Succinylcholine", note: "", minMultiplier: 1.0, maxMultiplier: 1.5, unit: "mg", baseName: "TBW", baseValue: weightInput },
                { name: "Rocuronium", note: "(Intubation)", multiplier: 0.6, unit: "mg", baseName: "IBW", baseValue: ibw },
                { name: "Sugammadex", note: "(Routine)", multiplier: 2.0, unit: "mg", baseName: "TBW", baseValue: weightInput },
                { name: "Fentanyl", note: "", multiplier: 1.5, unit: "mcg", baseName: "LBW", baseValue: lbw },
                { name: "Neostigmine", note: "", multiplier: 0.05, unit: "mg", baseName: "ABW", baseValue: adjbw }
            ];

            const tbody = document.getElementById('drug-table-body');
            tbody.innerHTML = ''; 
            
            const doseTextColor = isFemale ? 'text-pink-500' : 'text-blue-500';

            drugs.forEach(drug => {
                
                if (!isObese) {
                    drug.baseName = "TBW";
                    drug.baseValue = weightInput;
                }

                let totalDoseDisplay = "";
                let baseDoseDisplay = "";

                if (drug.minMultiplier !== undefined && drug.maxMultiplier !== undefined) {
                    const minDose = (drug.minMultiplier * drug.baseValue).toFixed(0); 
                    const maxDose = (drug.maxMultiplier * drug.baseValue).toFixed(0);
                    totalDoseDisplay = `${minDose} - ${maxDose}`;
                    baseDoseDisplay = `${drug.minMultiplier} - ${drug.maxMultiplier}`;
                } else {
                    totalDoseDisplay = (drug.multiplier * drug.baseValue).toFixed(1);
                    baseDoseDisplay = drug.multiplier;
                }

                const noteHtml = drug.note ? `<span class="text-sm text-gray-400 font-normal ml-1">${drug.note}</span>` : "";

                const tr = document.createElement('tr');
                tr.className = "hover:bg-gray-50 border-b last:border-0 transition-colors";
                tr.innerHTML = `
                    <td class="p-3 font-medium text-gray-800 text-base">${drug.name} ${noteHtml}</td>
                    <td class="p-3 text-sm text-gray-500">${baseDoseDisplay} ${drug.unit}/kg <br><span class="bg-gray-100 text-gray-600 px-2 py-0.5 rounded text-xs border">${drug.baseName}</span></td>
                    <td class="p-3 font-bold ${doseTextColor} text-lg text-right">${totalDoseDisplay} <span class="text-sm font-normal text-gray-500">${drug.unit}</span></td>
                `;
                tbody.appendChild(tr);
            });
        }

        function updateTheme(isFemale) {
            const labelMale = document.getElementById('label-male');
            const labelFemale = document.getElementById('label-female');
            const appTitle = document.getElementById('app-title');
            const weightCard = document.getElementById('weight-card');
            const cardBorder = document.getElementById('card-border');
            const resTexts = document.querySelectorAll('.res-text'); // ดึงทุกตัวเลขที่ต้องการเปลี่ยนสี รวมถึง BMI ด้วย
            
            if (isFemale) {
                labelMale.className = "text-gray-400 font-bold transition-colors duration-300";
                labelFemale.className = "text-pink-400 font-bold transition-colors duration-300";
                appTitle.className = "text-2xl font-bold text-center mb-6 text-pink-400 transition-colors duration-300";
                weightCard.className = "grid grid-cols-2 gap-6 mb-6 p-6 rounded-3xl shadow-inner bg-pink-50 transition-colors duration-300";
                cardBorder.style.borderColor = "#f9a8d4"; 
                // เปลี่ยนสีตัวเลขทั้งหมดเป็นสีชมพู
                resTexts.forEach(el => el.className = "text-2xl font-bold text-pink-500 res-text transition-colors duration-300");
            } else {
                labelMale.className = "text-blue-400 font-bold transition-colors duration-300";
                labelFemale.className = "text-gray-400 font-bold transition-colors duration-300";
                appTitle.className = "text-2xl font-bold text-center mb-6 text-blue-400 transition-colors duration-300";
                weightCard.className = "grid grid-cols-2 gap-6 mb-6 p-6 rounded-3xl shadow-inner bg-blue-50 transition-colors duration-300";
                cardBorder.style.borderColor = "#93c5fd"; 
                // เปลี่ยนสีตัวเลขทั้งหมดเป็นสีฟ้า
                resTexts.forEach(el => el.className = "text-2xl font-bold text-blue-500 res-text transition-colors duration-300");
            }
        }
        
        window.onload = () => { calculate(); };
    </script>
</body>
</html>
